{% extends "base.html" %}

{% block title %}Панель управления - АС УЗ{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h2>Все задачи</h2>
    <div class="dashboard-actions">
        <a href="{{ url_for('create_task_public') }}" class="btn btn-primary">Создать задачу</a>
        {% if session.role == 'admin' %}
        <a href="{{ url_for('admin') }}" class="btn btn-secondary">Управление пользователями</a>
        {% endif %}
    </div>
</div>

{% if tasks %}
<div class="table-container">
    <table class="tasks-table">
        <thead>
            <tr>
                <th>Номер</th>
                <th>Краткое описание</th>
                <th>Статус</th>
                <th>Прогресс</th>
                <th>Важность</th>
                <th>Срочность</th>
                <th>Ответственный</th>
                <th>Создана</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td class="task-number">{{ task.number }}</td>
                <td class="task-title">
                    <a href="{{ url_for('task_detail', task_id=task.id) }}">{{ task.title }}</a>
                </td>
                <td>
                    <span class="status status-{{ task.status }}">{{ status_labels[task.status] }}</span>
                </td>
                <td>
                    <div class="progress-cell">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ task.progress }}%"></div>
                        </div>
                        <span class="progress-text">{{ task.progress }}%</span>
                    </div>
                </td>
                <td>
                    <span class="priority priority-{{ task.priority }}">{{ priority_labels[task.priority] }}</span>
                </td>
                <td>
                    <span class="urgency urgency-{{ task.urgency }}">{{ urgency_labels[task.urgency] }}</span>
                </td>
                <td class="assigned-to">
                    {% if task.assigned_to %}
                        {{ task.assigned_to }}
                    {% else %}
                        <span class="not-assigned">Не назначен</span>
                    {% endif %}
                </td>
                <td class="task-date">{{ task.created_at[:10] }}</td>
                <td class="task-actions">
                    <a href="{{ url_for('task_detail', task_id=task.id) }}" class="btn btn-small">Подробнее</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="no-tasks">
    <h3>Задачи отсутствуют</h3>
    <p>Пока нет ни одной задачи. <a href="{{ url_for('create_task_public') }}">Создайте первую задачу</a></p>
</div>
{% endif %}
{% endblock %}